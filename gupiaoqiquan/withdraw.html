<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="wap-font-scale" content="no">
    <meta name="format-detection" content="telephone=no">
    <title>我要提现</title>

    <script src="js/jquery-1.8.3.min.js"></script>
    <script src="js/fastclick.js"></script>
    <link rel="stylesheet" href="js/layui/css/layui.css">
    <link rel="stylesheet" href="css/withdraw.css">
</head>

<body ontouchstart="">

    <form method="post" class="layui-form">

        <div class="weui_cells weui_cells_access">
            <a class="weui_cell" href="javascript:;">
                <div class="weui_cell_bd weui_cell_primary">
                    <p>当前结余</p>
                </div>
                <div class="weui_cell_ft balance">144680.00 元</div>
            </a>
            <a class="weui_cell" href="./withdrawalrecord.html">
                <div class="weui_cell_bd weui_cell_primary">
                    <p>提现记录</p>
                </div>
                <div class="weui_cell_ft">
                </div>
            </a>
        </div>

        <div class="weui_cells weui_cells_form" style="overflow: initial;">
            <div class="weui_cell">
                <div class="weui_cell_hd"><label class="weui_label">姓名</label></div>
                <div class="weui_cell_bd weui_cell_primary">
                    <input name="username" lay-verify="username" class="weui_input" type="text" placeholder="银行开户名">
                </div>
            </div>
            <div class="weui_cell">
                <div class="weui_cell_hd"><label class="weui_label">卡号</label></div>
                <div class="weui_cell_bd weui_cell_primary">
                    <input name="isnumber" lay-verify="isnumber" class="weui_input" type="number" placeholder="银行卡卡号">
                </div>
            </div>
            <div class="weui_cell">
                <div class="weui_cell_hd"><label class="weui_label">银行</label></div>
                <div class="weui_cell_bd weui_cell_primary">
                    <!-- class="weui_select bank_select" -->
                    <input name="bank" lay-verify="bank" class="weui_input" type="text" placeholder="银行开户网点名称">
                </div>
            </div>
            <div class="weui_cell">
                <div class="weui_cell_hd"><label class="weui_label">网点</label></div>
                <div class="weui_cell_bd weui_cell_primary">
                    <input name="deposit" lay-verify="deposit" class="weui_input" type="text" placeholder="银行开户网点名称">
                </div>
            </div>
            <div class="weui_cell">
                <div class="weui_cell_hd"><label class="weui_label">金额</label></div>
                <div class="weui_cell_bd weui_cell_primary">
                    <input name="stake" lay-verify="stake" class="weui_input" type="number" placeholder="最低提现金额 100 元">
                </div>
            </div>
        </div>

        <div class="weui_cells weui_cells_access">
            <div class="weui_cell">
                <div class="weui_cell_hd"><label class="weui_label">手机号</label></div>
                <div class="weui_cell_bd weui_cell_primary">
                    <input id="registerUserName" name="phone" class="weui_input userPhone" placeholder="输入手机号码" type="text" style="padding-left: 10px;">
                </div>
            </div>
            <div class="weui_cell">
                <div class="weui_cell_hd"><label class="weui_label">验证码</label></div>
                <div class="weui_cell_bd weui_cell_primary">
                    <input name="codes" class="weui_input" lay-verify="codes" type="text" placeholder="输入手机验证码" style="padding-left: 10px;  width: 60%;">
                    <input type="button" id="btn" class="register-getnum" value="获取验证码" style="    height: 30px;    width: 100px;padding: 5px; border: none;     -webkit-appearance: none;color: #333;">
                </div>
            </div>
        </div>

        <div class="weui_btn_area">
            <!-- <a href="javascript:document.getElementsByTagName(&#39;form&#39;)[0].submit();" class="weui_btn weui_btn_primary">确认</a> -->
            <button type="button" lay-submit class="weui_btn weui_btn_primary txBtn">确认</button>
        </div>

    </form>
    <!-- <script type="text/javascript">
        var wait = 5;

        function time(o) {
            if (wait == 0) {
                o.removeAttribute("disabled");
                o.value = "获取验证码";
                wait = 60;
            } else {
                o.setAttribute("disabled", true);
                o.value = "重新发送(" + wait + ")";
                wait--;
                setTimeout(function() {
                        time(o)
                    },
                    1000)
            }
        }
        var tel = '17093173505';
        $('#btn').click(function() {
            if (tel == null || tel == undefined || tel == '') {
                alert('当前用户信息为空');
            } else {
                $.post("/home/postSMS", {
                        tel: tel,
                        type: 1
                    },
                    function(data, status) {
                        if (data == 106) {
                            alert('該手機號已存在');
                        } else if (data == 1) {
                            document.getElementById("btn").onclick = function() {
                                time(this);
                            }
                            alert('短信發送成功');
                        } else {
                            alert('短信發送失敗');
                        }
                    });
            }
        })
    </script> -->
    <div id="doneToast" style="display: none;">
        <div class="weui_mask_transparent"></div>
        <div class="weui_toast">
            <i class="weui_icon_toast"></i>
            <p class="weui_toast_content">成功</p>
        </div>
    </div>
    <div id="contentToast" style="display: none;">
        <div class="weui_mask_transparent"></div>
        <div class="weui_toast">
            <p class="weui_toast_content"></p>
        </div>
    </div>
    <div id="loadingToast" class="weui_loading_toast" style="display: none;">
        <div class="weui_mask_transparent"></div>
        <div class="weui_toast">
            <div class="weui_loading">
                <div class="weui_loading_leaf weui_loading_leaf_0"></div>
                <div class="weui_loading_leaf weui_loading_leaf_1"></div>
                <div class="weui_loading_leaf weui_loading_leaf_2"></div>
                <div class="weui_loading_leaf weui_loading_leaf_3"></div>
                <div class="weui_loading_leaf weui_loading_leaf_4"></div>
                <div class="weui_loading_leaf weui_loading_leaf_5"></div>
                <div class="weui_loading_leaf weui_loading_leaf_6"></div>
                <div class="weui_loading_leaf weui_loading_leaf_7"></div>
                <div class="weui_loading_leaf weui_loading_leaf_8"></div>
                <div class="weui_loading_leaf weui_loading_leaf_9"></div>
                <div class="weui_loading_leaf weui_loading_leaf_10"></div>
                <div class="weui_loading_leaf weui_loading_leaf_11"></div>
            </div>
            <p class="weui_toast_content">请稍候</p>
        </div>
    </div>
    <script type="text/html" id="templet_dialog_alert">
        <div class="app_dialog weui_dialog_alert">
            <div class="weui_mask"></div>
            <div class="weui_dialog">
                <div class="weui_dialog_hd"><strong class="weui_dialog_title">#TITLE#</strong></div>
                <div class="weui_dialog_bd">#CONTENT#</div>
                <div class="weui_dialog_ft">
                    <a id="app_dialog_close" href="javascript:app.services.dialog.remove();" class="weui_btn_dialog primary">我知道了</a>
                </div>
            </div>
        </div>
    </script>
    <script type="text/html" id="templet_dialog_confirm">
        <div class="app_dialog weui_dialog_confirm">
            <div class="weui_mask"></div>
            <div class="weui_dialog">
                <div class="weui_dialog_hd"><strong class="weui_dialog_title">#TITLE#</strong></div>
                <div class="weui_dialog_bd">#CONTENT#</div>
                <div class="weui_dialog_ft">
                    <a id="app_dialog_close" href="javascript:app.services.dialog.remove();" class="weui_btn_dialog default">取消</a>
                    <a id="app_dialog_callback" class="weui_btn_dialog primary">确定</a>
                </div>
            </div>
        </div>
    </script>
    <script src="js/url.js"></script>
    <script src="js/layui/layui.js"></script>
    <script>
        var localSuserToken = localStorage.getItem('userToken');

        //获取用户数据到 页面
        $.ajax({
            url: test_url + pro_name + 'user/get/phone',
            //请求的url
            dataType: 'jsonp',
            jsonp: "callback",
            data: {
                userToken: localSuserToken
            },
            beforeSend: function() {

            },
            success: function(data) {
                console.log(data)
                if (data.status === 200) {
                    // userPhone
                    // layer.msg('登录成功', {
                    $('.balance').text(data.data.balance + '元')
                        // $('.userPhone').val(data.data.userPhone)
                } else {
                    // $('.lg').hide().siblings().show();
                    layer.msg(data.msg)
                }

            },
            error: function(xhr, status, error) {
                    // $('.lg').hide().siblings().show();
                } //error end
        });
    </script>
    <script>
        layui.use(['form'], function() {
            var form = layui.form;




            form.verify({
                username: [
                    /\S/, '银行账户名称不能为空'
                    // /^[\S]{3,12}$/, '密码必须6到12位，且不能出现空格'
                ],
                isnumber: [
                    /\S/, '银行卡号不能为空'
                ],
                deposit: [
                    /\S/, '网点不能为空'
                ],
                codes: [
                    /\S/, '短信验证码不能为空'
                ],
                bank: [
                    /\S/, '银行名称不能为空'
                ],
                stake: function(value) {
                    var tsVal = /\S/
                    console.log(isNaN(parseInt(value)))
                    if (value < 100 || value == 'e') {
                        return '请输入正确的提现金额'
                    }
                },
                d: [
                    /^[\S]{3,12}$/, '请输入推荐人ID'
                ]
            })
            form.on('submit', function(data) {
                // layer.msg('请先配置提交数据的后台');
                console.log(data)
                    // $('.lg').show().siblings().hide();
                $.ajax({
                    url: test_url + pro_name + 'user/insert/enchashmentInfo',
                    //请求的url
                    dataType: 'jsonp',
                    jsonp: "callback",
                    data: {
                        userToken: localSuserToken,
                        userName: data.field.username,
                        openAccount: data.field.isnumber,
                        openBank: data.field.bank,
                        openPlace: data.field.deposit,
                        enchashmentMoney: data.field.stake,
                        code: data.field.codes
                    },
                    beforeSend: function() {

                    },
                    success: function(data) {
                        console.log(data)
                        if (data.status === 200) {
                            layer.msg('提现成功,请等待审核', {
                                    time: 3000
                                }, function() {
                                    $.ajax({
                                        url: test_url + pro_name + 'user/get/phone',
                                        //请求的url
                                        dataType: 'jsonp',
                                        jsonp: "callback",
                                        data: {
                                            userToken: localSuserToken
                                        },
                                        beforeSend: function() {

                                        },
                                        success: function(data) {
                                            console.log(data)
                                            if (data.status === 200) {
                                                // userPhone
                                                // layer.msg('登录成功', {
                                                $('.balance').text(data.data.balance + '元')
                                                    // $('.userPhone').val(data.data.userPhone)
                                            } else {
                                                // $('.lg').hide().siblings().show();
                                                layer.msg(data.msg)
                                            }

                                        },
                                        error: function(xhr, status, error) {
                                                // $('.lg').hide().siblings().show();
                                            } //error end
                                    });
                                    // $('.lg').hide().siblings().show();
                                    // localStorage.setItem('userToken', data.data)
                                    // location.href = "./login.html "
                                })
                                // $('.menu>p>i').text(data.data.nowSum);
                                // $('.menu>p>span>i').text(data.data.sum)
                        } else {
                            // $('.lg').hide().siblings().show();
                            layer.msg(data.msg)
                        }

                    },
                    error: function(xhr, status, error) {

                        } //error end
                });
            })


            //获取短信认证信息
            $('.register-getnum').click(function() {
                var regPhone = /^1\d{10}$/;
                if (regPhone.test($('#registerUserName').val())) {
                    var _this = $(this)

                    // if (data.status === 200) {
                    _this.attr('disabled', true)

                    // .css('background', '#e6e6e6').css('color', '#E0BB2C')
                    var sTiem = 60;
                    var stopT = setInterval(function() {
                        sTiem--
                        _this.val(sTiem);
                        if (sTiem == 0) {
                            sTiem = 60;
                            clearInterval(stopT)
                            _this.removeAttr('disabled').val('获取验证码')
                                // .css('background', '#E0BB2C').css('color', '#fff')
                        }
                    }, 1000)
                    setTimeout(function() {
                            _this.removeAttr('disabled')
                                // .css('background', '#E0BB2C')
                        }, 60000)
                        // } else {
                        // }
                    $.ajax({
                        url: test_url + pro_name + "user/in/register/code ",
                        //请求的url
                        dataType: 'jsonp',
                        jsonp: "callback",
                        data: {
                            "userPhone": parseInt($('#registerUserName').val())
                        },
                        beforeSend: function() {
                            console.log('加载中。。。。。')
                        },
                        success: function(data) {
                            console.log(data);
                            if (data.status === 200) {
                                layer.msg('获取成功,请查看手机验证码', {
                                    time: 2000
                                }, function() {

                                });
                            } else {
                                layer.msg(data.msg, {
                                    time: 2000
                                }, function() {

                                });
                            }

                        },
                        error: function(XMLHttpRequest, textStatus, errorThrown) {
                            // layer.msg('网络连接失败,请重新注册', {
                            //     time: 2000
                            // }, function() {

                            // });
                        }
                    }); //ajax end*/
                } else {
                    layer.msg('请输入正确的手机号', {
                        icon: 5,
                        shift: 6
                    });
                }
            })
        })
    </script>
</body>

</html>